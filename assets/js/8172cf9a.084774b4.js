"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[404],{5419:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>p,frontMatter:()=>d,metadata:()=>r,toc:()=>h});const r=JSON.parse('{"id":"middleware/introduction","title":"introduction","description":"Middleware allow you to customize the behavior of the positioning and be as granular as you want, adding your own custom logic.","source":"@site/docs/middleware/introduction.md","sourceDirName":"middleware","slug":"/middleware","permalink":"/aether/docs/middleware","draft":false,"unlisted":false,"editUrl":"https://github.com/quamatic/aether/tree/main/website/docs/middleware/introduction.md","tags":[],"version":"current","frontMatter":{"id":"introduction","slug":"/middleware"},"sidebar":"aether","previous":{"title":"Virtual Elements","permalink":"/aether/docs/guides/virtual-elements"},"next":{"title":"offset","permalink":"/aether/docs/middleware/offset"}}');var l=t(6106),a=t(2036),i=t(9269),s=t(8914);const d={id:"introduction",slug:"/middleware"},c="Middleware",o={},h=[{value:"Example",id:"example",level:2},{value:"Shape",id:"shape",level:2},{value:"<code>name</code>",id:"name",level:3},{value:"<code>run</code>",id:"run",level:3},{value:"Middleware State",id:"middleware-state",level:2},{value:"<code>x</code>",id:"x",level:3},{value:"<code>y</code>",id:"y",level:3},{value:"<code>initialPlacement</code>",id:"initialplacement",level:3},{value:"<code>placement</code>",id:"placement",level:3},{value:"<code>data</code>",id:"data",level:3},{value:"<code>elements</code>",id:"elements",level:3},{value:"<code>rects</code>",id:"rects",level:3},{value:"<code>rtl</code>",id:"rtl",level:3},{value:"<code>cache</code>",id:"cache",level:3},{value:"Ordering",id:"ordering",level:2},{value:"Resetting the lifecycle",id:"resetting-the-lifecycle",level:2},{value:"Object Properties",id:"object-properties",level:3},{value:"<code>placement</code>",id:"placement-1",level:4},{value:"<code>rects</code>",id:"rects-1",level:4}];function u(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"middleware",children:"Middleware"})}),"\n",(0,l.jsx)(n.p,{children:"Middleware allow you to customize the behavior of the positioning and be as granular as you want, adding your own custom logic."}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"process()"})," starts with initial positioning via ",(0,l.jsx)(n.code,{children:"placement"})," \u2014 then middleware are executed as an in-between \u201cmiddle\u201d step of the initial placement computation and eventual return of data for rendering."]}),"\n",(0,l.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,l.jsxs)(i.A,{groupId:"package-manager",children:[(0,l.jsx)(s.A,{value:"wally",label:"luau",default:!0,children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-luau",children:'local Aether = require(path.to.aether)\n\nlocal shiftByOnePixel: Aether.Middleware = {\n    name = "shiftByOnePixel",\n    run = function(state)\n        return {\n            x = state.x + 1,\n            y = state.y + 1,\n        }\n    end,\n}\n'})})}),(0,l.jsx)(s.A,{value:"roblox-ts",label:"roblox-ts",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:'import { process, type Middleware } from "@rbxts/aether";\n\nconst shiftByOnePixel: Middleware = {\n    name: "shiftByOnePixel",\n    run: (state) => ({\n        x: state.x + 1,\n        y: state.y + 1,\n    }),\n};\n'})})})]}),"\n",(0,l.jsxs)(n.p,{children:["This (not particularly useful) middleware adds ",(0,l.jsx)(n.code,{children:"1"})," pixel to the coordinates. To use this middleware, add it to your ",(0,l.jsx)(n.code,{children:"middleware"})," array:"]}),"\n",(0,l.jsxs)(i.A,{groupId:"package-manager",children:[(0,l.jsx)(s.A,{value:"wally",label:"luau",default:!0,children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-luau",children:"local Aether = require(path.to.aether)\n\nAether.process(reference, target, {\n    middleware = { shiftByOnePixel }\n})\n"})})}),(0,l.jsx)(s.A,{value:"roblox-ts",label:"roblox-ts",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:'import { process } from "@rbxts/aether";\n\nprocess(reference, target, {\n    middleware: [shiftByOnePixel]\n});\n'})})})]}),"\n",(0,l.jsx)(n.h2,{id:"shape",children:"Shape"}),"\n",(0,l.jsxs)(n.p,{children:["This is the shape of the ",(0,l.jsx)(n.code,{children:"Middleware"})," type:"]}),"\n",(0,l.jsxs)(i.A,{groupId:"package-manager",children:[(0,l.jsx)(s.A,{value:"wally",label:"luau",default:!0,children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-luau",children:"type Middleware<T> = {\n    name: string,\n    run: (state: MiddlewareState) => MiddlewareResult<T>\n}\n"})})}),(0,l.jsx)(s.A,{value:"roblox-ts",label:"roblox-ts",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"interface Middleware<T> {\n    name: string;\n    run: (state: MiddlewareState) => MiddlewareResult<T>;\n}\n"})})})]}),"\n",(0,l.jsx)(n.h3,{id:"name",children:(0,l.jsx)(n.code,{children:"name"})}),"\n",(0,l.jsxs)(n.p,{children:["A ",(0,l.jsx)(n.strong,{children:"unique"})," name that identifies the middleware. If the middleware generates a result containing data, this name will be used as the key for that data in the result."]}),"\n",(0,l.jsx)(n.h3,{id:"run",children:(0,l.jsx)(n.code,{children:"run"})}),"\n",(0,l.jsx)(n.p,{children:"The function executed when the middleware is processed."}),"\n",(0,l.jsx)(n.h2,{id:"middleware-state",children:"Middleware State"}),"\n",(0,l.jsxs)(n.p,{children:["An object is passed to ",(0,l.jsx)(n.code,{children:"run"})," containing useful data about the middleware lifecycle being executed."]}),"\n",(0,l.jsxs)(n.p,{children:["In the previous examples, we destructured ",(0,l.jsx)(n.code,{children:"x"})," and ",(0,l.jsx)(n.code,{children:"y"})," out of the ",(0,l.jsx)(n.code,{children:"run"})," parameter object. These are only two properties that get passed into middleware, but there are many more."]}),"\n",(0,l.jsx)(n.p,{children:"The properties passed are below:"}),"\n",(0,l.jsxs)(i.A,{groupId:"package-manager",children:[(0,l.jsx)(s.A,{value:"wally",label:"luau",default:!0,children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-luau",children:"type MiddlewareState = {\n    x: number,\n    y: number,\n    initialPlacement: Placement,\n    placement: Placement,\n    data: MiddlewareData,\n    elements: ElementRefs,\n    rects: ElementRects,\n    rtl: boolean,\n    cache: Cache,\n}\n"})})}),(0,l.jsx)(s.A,{value:"roblox-ts",label:"roblox-ts",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"interface MiddlewareState {\n    x: number;\n    y: number;\n    initialPlacement: Placement;\n    placement: Placement;\n    data: MiddlewareData;\n    elements: ElementRefs;\n    rects: ElementRects;\n    rtl: boolean;\n    cache: Cache;\n}\n"})})})]}),"\n",(0,l.jsx)(n.h3,{id:"x",children:(0,l.jsx)(n.code,{children:"x"})}),"\n",(0,l.jsx)(n.p,{children:"This is the current x-axis coordinate to position the floating element to."}),"\n",(0,l.jsx)(n.h3,{id:"y",children:(0,l.jsx)(n.code,{children:"y"})}),"\n",(0,l.jsx)(n.p,{children:"This is the current y-axis coordinate to position the floating element to."}),"\n",(0,l.jsx)(n.h3,{id:"initialplacement",children:(0,l.jsx)(n.code,{children:"initialPlacement"})}),"\n",(0,l.jsxs)(n.p,{children:["The initial (or preferred) placement passed in to ",(0,l.jsx)(n.code,{children:"process()"}),"."]}),"\n",(0,l.jsx)(n.h3,{id:"placement",children:(0,l.jsx)(n.code,{children:"placement"})}),"\n",(0,l.jsxs)(n.p,{children:["The stateful resultant placement. Middleware like ",(0,l.jsx)(n.code,{children:"flip()"})," change ",(0,l.jsx)(n.code,{children:"initialPlacement"})," to a new one."]}),"\n",(0,l.jsx)(n.h3,{id:"data",children:(0,l.jsx)(n.code,{children:"data"})}),"\n",(0,l.jsxs)(n.p,{children:["This is an object containing all the data of any middleware at the current step in the lifecycle. The lifecycle loops over the ",(0,l.jsx)(n.code,{children:"middleware"})," array, so later middleware have access to data from any middleware run prior."]}),"\n",(0,l.jsx)(n.h3,{id:"elements",children:(0,l.jsx)(n.code,{children:"elements"})}),"\n",(0,l.jsx)(n.p,{children:"This is an object containing the reference and floating elements."}),"\n",(0,l.jsx)(n.h3,{id:"rects",children:(0,l.jsx)(n.code,{children:"rects"})}),"\n",(0,l.jsxs)(n.p,{children:["This is an object containing the ",(0,l.jsx)(n.code,{children:"Rect"}),"s of the reference and floating elements, an object of shape ",(0,l.jsx)(n.code,{children:"{ width, height, x, y }"}),"."]}),"\n",(0,l.jsx)(n.h3,{id:"rtl",children:(0,l.jsx)(n.code,{children:"rtl"})}),"\n",(0,l.jsxs)(n.p,{children:["The right-to-left boolean flag passed in to ",(0,l.jsx)(n.code,{children:"process()"}),"."]}),"\n",(0,l.jsx)(n.h3,{id:"cache",children:(0,l.jsx)(n.code,{children:"cache"})}),"\n",(0,l.jsx)(n.p,{children:"The cache used for storing elements and scales during the lifecycle."}),"\n",(0,l.jsx)(n.h2,{id:"ordering",children:"Ordering"}),"\n",(0,l.jsx)(n.p,{children:"The order in which middleware are placed in the array matters, as middleware use the coordinates that were returned from previous ones. This means they perform their work based on the current positioning state."}),"\n",(0,l.jsxs)(n.p,{children:["Three ",(0,l.jsx)(n.code,{children:"shiftByOnePixel"})," in the middleware array means the coordinates get shifted by 3 pixels in total:"]}),"\n",(0,l.jsxs)(i.A,{groupId:"package-manager",children:[(0,l.jsx)(s.A,{value:"wally",label:"luau",default:!0,children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-luau",children:'local Aether = require(path.to.aether)\n\nlocal shiftByOnePixel: Aether.Middleware = {\n    name = "shiftByOnePixel",\n    run = function(state)\n        return {\n            x = state.x + 1,\n            y = state.y + 1,\n        }\n    end,\n}\n\nAether.proess(reference, target, {\n    middleware = {\n        shiftByOnePixel,\n        shiftByOnePixel,\n        shiftByOnePixel\n    }\n})\n'})})}),(0,l.jsx)(s.A,{value:"roblox-ts",label:"roblox-ts",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:'import { process, type Middleware } from "@rbxts/aether";\n\nconst shiftByOnePixel: Middleware = {\n    name: "shiftByOnePixel",\n    run: (state) => ({\n        x: state.x + 1,\n        y: state.y + 1,\n    }),\n};\n\nprocess(reference, target, {\n    middleware: [\n        shiftByOnePixel,\n        shiftByOnePixel,\n        shiftByOnePixel\n    ],\n});\n'})})})]}),"\n",(0,l.jsxs)(n.p,{children:["If the later ",(0,l.jsx)(n.code,{children:"shiftByOnePixel"})," implementations had a condition based on the current value of ",(0,l.jsx)(n.code,{children:"x"})," and ",(0,l.jsx)(n.code,{children:"y"}),", the condition can change based on their placement in the array."]}),"\n",(0,l.jsx)(n.p,{children:"Understanding this can help in knowing which order to place middleware in, as placing a middleware before or after another can produce a different result."}),"\n",(0,l.jsx)(n.h2,{id:"resetting-the-lifecycle",children:"Resetting the lifecycle"}),"\n",(0,l.jsx)(n.p,{children:"There are use cases for needing to reset the middleware lifecycle so that other middleware perform fresh logic."}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["When ",(0,l.jsx)(n.code,{children:"flip()"})," and ",(0,l.jsx)(n.code,{children:"autoPlacement()"})," change the placement, they reset the lifecycle so that other middleware that modify the coordinates based on the current placement do not perform stale logic."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"size()"})," resets the lifecycle with the newly applied dimensions, as many middleware read the dimensions to perform their logic."]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["In order to do this, add a ",(0,l.jsx)(n.code,{children:"reset"})," property to the returned object from ",(0,l.jsx)(n.code,{children:"fn"}),"."]}),"\n",(0,l.jsxs)(i.A,{groupId:"package-manager",children:[(0,l.jsx)(s.A,{value:"wally",label:"luau",default:!0,children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-luau",children:"type Reset = true | {\n    placement: Placement?,\n    rects: true | ElementRects?,\n}\n"})})}),(0,l.jsx)(s.A,{value:"roblox-ts",label:"roblox-ts",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-typescript",children:"type Reset =\n    | true\n    | {\n        placement?: Placement;\n        rects?: true | ElementRects;\n    };\n"})})})]}),"\n",(0,l.jsxs)(n.p,{children:["The ",(0,l.jsx)(n.code,{children:"Reset"})," type offers two modes for resetting behavior:"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"true"})," \u2013 A complete reset of all middleware computations, without introducing new state."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"An object"})," \u2013 Allows selective resetting with additional options for customization."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"object-properties",children:"Object Properties"}),"\n",(0,l.jsx)(n.h4,{id:"placement-1",children:(0,l.jsx)(n.code,{children:"placement"})}),"\n",(0,l.jsx)(n.p,{children:"Specifies the starting placement after resetting."}),"\n",(0,l.jsx)(n.h4,{id:"rects-1",children:(0,l.jsx)(n.code,{children:"rects"})}),"\n",(0,l.jsxs)(n.p,{children:["Controls how the ",(0,l.jsx)(n.code,{children:"rects"})," of elements are recomputed:"]}),"\n",(0,l.jsxs)(n.p,{children:["When set to ",(0,l.jsx)(n.code,{children:"true"}),", the ",(0,l.jsx)(n.code,{children:"rects"})," will automatically be re-computed. Otherwise, you can return your own new ",(0,l.jsx)(n.code,{children:"rects"}),"."]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(u,{...e})}):u(e)}},8914:(e,n,t)=>{t.d(n,{A:()=>i});t(7378);var r=t(3372);const l={tabItem:"tabItem_FS4i"};var a=t(6106);function i(e){let{children:n,hidden:t,className:i}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,r.A)(l.tabItem,i),hidden:t,children:n})}},9269:(e,n,t)=>{t.d(n,{A:()=>v});var r=t(7378),l=t(3372),a=t(2703),i=t(505),s=t(5086),d=t(6656),c=t(2097),o=t(421);function h(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:n,children:t}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return h(e).map((e=>{let{props:{value:n,label:t,attributes:r,default:l}}=e;return{value:n,label:t,attributes:r,default:l}}))}(t);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function p(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:t}=e;const l=(0,i.W6)(),a=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,d.aZ)(a),(0,r.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(l.location.search);n.set(a,e),l.replace({...l.location,search:n.toString()})}),[a,l])]}function x(e){const{defaultValue:n,queryString:t=!1,groupId:l}=e,a=u(e),[i,d]=(0,r.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=t.find((e=>e.default))??t[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:a}))),[c,h]=m({queryString:t,groupId:l}),[x,f]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[l,a]=(0,o.Dv)(t);return[l,(0,r.useCallback)((e=>{t&&a.set(e)}),[t,a])]}({groupId:l}),j=(()=>{const e=c??x;return p({value:e,tabValues:a})?e:null})();(0,s.A)((()=>{j&&d(j)}),[j]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);d(e),h(e),f(e)}),[h,f,a]),tabValues:a}}var f=t(7606);const j={tabList:"tabList_scTV",tabItem:"tabItem_tmPb"};var g=t(6106);function b(e){let{className:n,block:t,selectedValue:r,selectValue:i,tabValues:s}=e;const d=[],{blockElementScrollPositionUntilNextRender:c}=(0,a.a_)(),o=e=>{const n=e.currentTarget,t=d.indexOf(n),l=s[t].value;l!==r&&(c(n),i(l))},h=e=>{let n=null;switch(e.key){case"Enter":o(e);break;case"ArrowRight":{const t=d.indexOf(e.currentTarget)+1;n=d[t]??d[0];break}case"ArrowLeft":{const t=d.indexOf(e.currentTarget)-1;n=d[t]??d[d.length-1];break}}n?.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.A)("tabs",{"tabs--block":t},n),children:s.map((e=>{let{value:n,label:t,attributes:a}=e;return(0,g.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:e=>d.push(e),onKeyDown:h,onClick:o,...a,className:(0,l.A)("tabs__item",j.tabItem,a?.className,{"tabs__item--active":r===n}),children:t??n},n)}))})}function w(e){let{lazy:n,children:t,selectedValue:a}=e;const i=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=i.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:(0,l.A)("margin-top--md",e.props.className)}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==a})))})}function y(e){const n=x(e);return(0,g.jsxs)("div",{className:(0,l.A)("tabs-container",j.tabList),children:[(0,g.jsx)(b,{...n,...e}),(0,g.jsx)(w,{...n,...e})]})}function v(e){const n=(0,f.A)();return(0,g.jsx)(y,{...e,children:h(e.children)},String(n))}},2036:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>s});var r=t(7378);const l={},a=r.createContext(l);function i(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);